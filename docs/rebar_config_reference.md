# 螺纹钢策略配置详解 (Rebar Strategy Configuration Reference)

本文档详细解释了 `strategy/rebar/params.json` 配置文件中各个字段的含义与作用。该配置文件用于控制螺纹钢量化策略的交易时间、价格过滤、合约切换逻辑以及核心风控参数。

## 1. 时间过滤 (time_filter)
控制策略允许交易的时间窗口及强制平仓时段。

*   **`trading_sessions`**: 允许开仓交易的时段列表。
    *   `start`: 开始时间 (HH:MM)。
    *   `end`: 结束时间 (HH:MM)。
    *   *作用*: 仅在这些时间段内产生交易信号，非交易时段（如午休）不处理信号。
*   **`force_close_windows`**: 强制平仓或禁止开仓的风险时段。
    *   *作用*: 在特定时间段（如开盘初剧烈波动期、收盘前）执行强制风控逻辑，例如禁止新开仓位或强制平掉隔夜风险。

## 2. 价格过滤 (price_filter)
基于价格行为的过滤规则，防止在特定价格区域产生的误导性信号。

*   **`integer_barriers`**: 整数关口列表 (如 3600, 3700)。
    *   *作用*: 定义关键的心理价位。
*   **`barrier_range`**: 关口范围 (点数)。
    *   *作用*: 定义整数关口上下的敏感区域 (例如 ±10点)。
*   **`barrier_min_fluctuation`**: 关口最小波动要求。
    *   *作用*: 如果价格在关口附近波动过小（窄幅震荡），则过滤掉突破信号，防止假突破。
*   **`limit_move_pct`**: 涨跌停板风控参数。
    *   `reduce_position_threshold` (0.05): 当价格触及涨跌幅 5% 时。
    *   `reduce_position_target` (0.01): 强制减仓至 1% 或更低。
    *   `stop_opening_threshold` (0.07): 当价格触及涨跌幅 7% 时，完全禁止开新仓。

## 3. 合约切换 (contract_switch)
控制主力合约切换时的权重调整逻辑。

*   **`months_before_delivery`**: 距离交割月的月份数阈值。
    *   *作用*: 当临近交割月时启动切换逻辑。
*   **`basis_thresholds`**: 基差（现货-期货）阈值。
    *   `deep_discount` (-0.015): 深贴水阈值 (-1.5%)。
    *   `high_premium` (0.015): 高升水阈值 (1.5%)。
*   **`weight_adjust`**: 权重调整系数 (0.3)。
    *   *作用*: 当触发深贴水（有利于做多）或高升水（有利于做空）时，对信号评分增加的额外权重值。

## 4. 风控控制 (risk_control)
核心资金管理与止损止盈参数。

### 4.1 基础参数
*   **`atr_period`**: ATR (平均真实波幅) 计算周期 (默认 14)。
    *   *作用*: 用于动态计算止损距离和仓位大小。

### 4.2 信号级风控 (signals)
针对不同类型的缠论买卖点 (1B, 2B, 3B) 设定差异化的风控规则。

#### 1B (第一类买卖点 - 趋势反转)
*   **`sl_multiplier`**: 止损倍数 (1.2)。
    *   *计算*: `止损价 = 低点 ± (1.2 * ATR)`。
*   **`initial_pos`**: 初始仓位比例 (3%)。
*   **`add_pos_target`**: 加仓目标比例 (5%)。
    *   *作用*: 价格创新高/新低后允许加仓至此比例。
*   **`tp_trigger`**: 止盈触发条件 ("center_bottom_or_2b")。
    *   *含义*: 触及前中枢下沿或出现反向 2B 信号时减半/止盈。

#### 2B (第二类买卖点 - 回调确认)
*   **`initial_pos`**: 初始仓位比例 (2%)。
*   **`max_pos`**: 该类型信号允许的最大总仓位 (8%)。
*   **`tp_trigger`**: 止盈触发条件 ("center_middle_or_top_fractal")。
    *   *含义*: 回归中枢中轴或出现顶分型时平仓。
*   *注意*: 2B 的止损通常取 `min(1B低点, 2B低点)` (代码逻辑实现，非参数配置)。

#### 3B (第三类买卖点 - 趋势中继)
*   **`initial_pos`**: 初始仓位比例 (2%)。
*   **`allow_add`**: 是否允许加仓 (false)。
    *   *作用*: 3B 往往是趋势末端，风险较高，禁止加仓。
*   **`tp_trigger`**: 止盈触发条件 ("prev_high_or_divergence")。
    *   *含义*: 突破前高或出现顶背驰时立即平仓。

### 4.3 全局风控 (global)
*   **`slippage_ticks`**: 滑点保护跳数 (2跳)。
    *   *作用*: 下单价格偏离最新价的允许范围。
*   **`max_single_loss`**: 单笔最大亏损比例 (2%)。
    *   *作用*: 任意单笔交易预计亏损超过此比例时，拒绝开仓或强制平仓。
*   **`max_total_drawdown`**: 账户总回撤阈值 (5%)。
    *   *作用*: 动态权益回撤超过 5% 时，触发熔断机制（如清仓或停止交易）。
